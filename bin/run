#!/bin/bash

ICINGA1CONF=/etc/icinga/icinga.cfg
ICINGA2CONF=/tmp/icinga2.conf
ICINGA2OBJECTS=/tmp/migrate.conf
ICINGA2BIN=/usr/sbin/icinga2

DEBUG="-x debug"
GDB=""
#GDB="gdb --args"

# convert
sudo bin/icinga-conftool migrate v1 $ICINGA1CONF > $ICINGA2OBJECTS

cat > $ICINGA2CONF <<EOF
const PluginDir = "/usr/lib/nagios/plugins"
include <itl>
include <plugins>

include "$ICINGA2OBJECTS"
EOF

# verify config
$GDB $ICINGA2BIN -c $ICINGA2CONF -C $DEBUG
